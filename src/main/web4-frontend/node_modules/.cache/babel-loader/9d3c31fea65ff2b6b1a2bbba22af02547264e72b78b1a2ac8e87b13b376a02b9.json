{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/frodo/IdeaProjects/web/web-itmo/web-lab-4/src/main/web4-frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/frodo/IdeaProjects/web/web-itmo/web-lab-4/src/main/web4-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/frodo/IdeaProjects/web/web-itmo/web-lab-4/src/main/web4-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useDispatch}from\"react-redux\";import{Alert,Button,Form}from\"react-bootstrap\";import{useState}from\"react\";import{useLoginMutation,useRegisterMutation}from\"../../features/auth/authApi\";import{setCredentials}from\"../../features/auth/userSlice\";import{useNavigate}from\"react-router\";import{AlertBar}from\"../error/AlertBar\";import{PasswordInput}from\"../form/PasswordInput\";import LoadingButton from\"../error/LoadingButton\";import{Link}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function LoginPage(){var navigate=useNavigate();var dispatch=useDispatch();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),username=_useState2[0],setUsername=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),errorMessage=_useState6[0],setErrorMessage=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),showErrorMessage=_useState8[0],setShowErrorMessage=_useState8[1];var _useLoginMutation=useLoginMutation(),_useLoginMutation2=_slicedToArray(_useLoginMutation,2),login=_useLoginMutation2[0],isLoading=_useLoginMutation2[1].isLoading;var onUsernameChanged=function onUsernameChanged(e){setUsername(e.target.value);};var onPasswordChanged=function onPasswordChanged(e){setPassword(e.target.value);};var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var result;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;_context.next=4;return login({username:username,password:password}).unwrap();case 4:result=_context.sent;dispatch(setCredentials(result));navigate('/');_context.next=13;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);setErrorMessage(\"Incorrect username or password\");// if (err.data && err.data.status===401) {\n//         setErrorMessage(\"Incorrect username or password\")\n// } else {\n//     setErrorMessage(\"Unexpected error occurred!\")\n// }\nsetShowErrorMessage(true);case 13:case\"end\":return _context.stop();}},_callee,null,[[1,9]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"h-75 mt-5 container d-flex justify-content-center align-items-center\",children:/*#__PURE__*/_jsxs(Form,{style:{width:400},className:\"w-30 shadow p-3 mb-5 bg-light text-black rounded\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"div\",{className:\"h3 text-center\",children:\"Sign in\"}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{className:\"text-black\",children:\"Username\"}),/*#__PURE__*/_jsx(Form.Control,{autoFocus:true,required:true,maxLength:20,type:\"text\",name:\"username\",onChange:onUsernameChanged})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{className:\"text-black\",children:\"Password\"}),/*#__PURE__*/_jsx(PasswordInput,{onChange:onPasswordChanged,value:password})]}),/*#__PURE__*/_jsx(Form.Group,{children:isLoading?/*#__PURE__*/_jsx(LoadingButton,{variant:\"success\",className:\"w-100\"}):/*#__PURE__*/_jsx(Button,{className:\"w-100\",variant:\"success\",type:\"submit\",disabled:username===\"\"||password===\"\",children:\"Sign in\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-black text-center mt\",children:[\"Don't have an account yet? \",/*#__PURE__*/_jsx(Link,{className:\"text-black\",to:\"/register\",children:\"Sign Up\"})]}),/*#__PURE__*/_jsx(AlertBar,{errorMessage:errorMessage,setShowErrorMessage:setShowErrorMessage,showErrorMessage:showErrorMessage})]})});}","map":{"version":3,"names":["useDispatch","Alert","Button","Form","useState","useLoginMutation","useRegisterMutation","setCredentials","useNavigate","AlertBar","PasswordInput","LoadingButton","Link","LoginPage","navigate","dispatch","username","setUsername","password","setPassword","errorMessage","setErrorMessage","showErrorMessage","setShowErrorMessage","login","isLoading","onUsernameChanged","e","target","value","onPasswordChanged","handleSubmit","preventDefault","unwrap","result","width"],"sources":["C:/Users/frodo/IdeaProjects/web/web-itmo/web-lab-4/src/main/web4-frontend/src/components/pages/LoginPage.js"],"sourcesContent":["import {useDispatch} from \"react-redux\";\r\nimport {Alert, Button, Form} from \"react-bootstrap\"\r\nimport {useState} from \"react\";\r\nimport {useLoginMutation, useRegisterMutation} from \"../../features/auth/authApi\";\r\nimport {setCredentials} from \"../../features/auth/userSlice\";\r\nimport {useNavigate} from \"react-router\";\r\nimport {AlertBar} from \"../error/AlertBar\";\r\nimport {PasswordInput} from \"../form/PasswordInput\";\r\nimport LoadingButton from \"../error/LoadingButton\";\r\nimport {Link} from \"react-router-dom\";\r\n\r\n\r\nexport default function LoginPage() {\r\n    const navigate = useNavigate();\r\n    const dispatch = useDispatch()\r\n    const [username, setUsername] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [errorMessage, setErrorMessage] = useState(\"\");\r\n    const [showErrorMessage, setShowErrorMessage] = useState(false);\r\n    const [login, {isLoading}] = useLoginMutation()\r\n\r\n    const onUsernameChanged = (e) => {\r\n        setUsername(e.target.value);\r\n    }\r\n\r\n    const onPasswordChanged = (e) => {\r\n        setPassword(e.target.value);\r\n    }\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault()\r\n        try {\r\n            const result = await login({username: username, password: password}).unwrap()\r\n            dispatch(setCredentials(result))\r\n            navigate('/')\r\n        } catch (err) {\r\n            setErrorMessage(\"Incorrect username or password\")\r\n            // if (err.data && err.data.status===401) {\r\n            //         setErrorMessage(\"Incorrect username or password\")\r\n            // } else {\r\n            //     setErrorMessage(\"Unexpected error occurred!\")\r\n            // }\r\n            setShowErrorMessage(true)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className='h-75 mt-5 container d-flex justify-content-center align-items-center'>\r\n            <Form style={{width: 400}}\r\n                  className=\"w-30 shadow p-3 mb-5 bg-light text-black rounded\"\r\n                  onSubmit={handleSubmit}>\r\n                <div className=\"h3 text-center\">\r\n                    Sign in\r\n                </div>\r\n                <Form.Group className=\"mb-3\">\r\n                    <Form.Label className=\"text-black\">Username</Form.Label>\r\n                    <Form.Control autoFocus required maxLength={20} type=\"text\" name=\"username\" onChange={onUsernameChanged} />\r\n                </Form.Group>\r\n                <Form.Group className=\"mb-3\">\r\n                    <Form.Label className=\"text-black\">Password</Form.Label>\r\n                    <PasswordInput onChange={onPasswordChanged} value={password} />\r\n                </Form.Group>\r\n                <Form.Group>\r\n                    {isLoading ?\r\n                        <LoadingButton variant=\"success\" className=\"w-100\" /> :\r\n                        <Button className=\"w-100\" variant=\"success\" type=\"submit\" disabled={username === \"\" || password === \"\"}>Sign in</Button>\r\n                    }\r\n                </Form.Group>\r\n                <div className=\"text-black text-center mt\">\r\n                    Don't have an account yet? <Link className='text-black' to=\"/register\">Sign Up</Link>\r\n                </div>\r\n\r\n                <AlertBar\r\n                    errorMessage={errorMessage}\r\n                    setShowErrorMessage={setShowErrorMessage}\r\n                    showErrorMessage={showErrorMessage}\r\n                />\r\n            </Form>\r\n        </div>\r\n\r\n    )\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}